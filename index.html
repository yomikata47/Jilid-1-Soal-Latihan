<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Halaman 34 ‚Äî Ujian Tengah Jilid</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP&display=swap" rel="stylesheet">

<style>
body{
  background:#f6f8fb;
  font-family:Arial,sans-serif;
}
.container{
  max-width:640px;
  margin:20px auto;
  background:#fff;
  padding:20px;
  border-radius:16px;
  box-shadow:0 8px 20px rgba(0,0,0,.08);
}
h1{text-align:center}

.question{
  background:#fafafa;
  padding:14px;
  border-radius:12px;
  margin-bottom:14px;
}

.kana{
  font-family:"Noto Serif JP","Yu Mincho",serif;
  font-size:46px;
  text-align:center;
  margin-bottom:12px;
}

.options{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}

button{
  padding:10px;
  border-radius:10px;
  border:2px solid #ddd;
  background:#fff;
  cursor:pointer;
}

button.correct{background:#4caf50;color:#fff}
button.wrong{background:#f44336;color:#fff}
button:disabled{opacity:.9}

#scoreBox{
  margin-top:20px;
  padding:14px;
  background:#eef2f7;
  border-radius:12px;
  display:flex;
  justify-content:space-between;
  font-weight:bold;
}

/* POPUP */
#popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:999;
}
.popup-content{
  background:#fff;
  padding:20px;
  border-radius:14px;
  max-width:320px;
  text-align:center;
}
.popup-content h2{margin-top:0}
.popup-content button{
  width:100%;
  margin-top:10px;
}
</style>
</head>

<body>

<div class="container">
<h1>Ujian Tengah Jilid<br>Blok 1‚Äì6</h1>

<div id="quiz"></div>

<div id="scoreBox">
  <div>Benar: <span id="benar">0</span></div>
  <div>Salah: <span id="salah">0</span> / 5</div>
</div>
</div>

<!-- POPUP -->
<div id="popup">
  <div class="popup-content" id="popupContent"></div>
</div>

<script>
/* ================== COOLDOWN ================== */
const COOLDOWN_MS = 3 * 60 * 60 * 1000; // 3 jam
const now = Date.now();
const lockUntil = localStorage.getItem("yomikata_lock");

if(lockUntil && now < lockUntil){
  document.body.innerHTML = `
    <div class="container">
      <h1>Akses Dikunci</h1>
      <p>Silakan beristirahat sejenak sembari mengulang pelajaran dan coba kembali setelah tiga jam.</p>
    </div>`;
  throw new Error("Locked");
}

/* ================== DATA KANA ================== */
const kana = [
  {h:"„ÅÇ",k:"„Ç¢",r:"a"},{h:"„ÅÑ",k:"„Ç§",r:"i"},{h:"„ÅÜ",k:"„Ç¶",r:"u"},{h:"„Åà",k:"„Ç®",r:"e"},{h:"„Åä",k:"„Ç™",r:"o"},
  {h:"„Åã",k:"„Ç´",r:"ka"},{h:"„Åç",k:"„Ç≠",r:"ki"},{h:"„Åè",k:"„ÇØ",r:"ku"},{h:"„Åë",k:"„Ç±",r:"ke"},{h:"„Åì",k:"„Ç≥",r:"ko"},
  {h:"„Åï",k:"„Çµ",r:"sa"},{h:"„Åó",k:"„Ç∑",r:"shi"},{h:"„Åô",k:"„Çπ",r:"su"},{h:"„Åõ",k:"„Çª",r:"se"},{h:"„Åù",k:"„ÇΩ",r:"so"},
  {h:"„Åü",k:"„Çø",r:"ta"},{h:"„Å°",k:"„ÉÅ",r:"chi"},{h:"„Å§",k:"„ÉÑ",r:"tsu"},{h:"„Å¶",k:"„ÉÜ",r:"te"},{h:"„Å®",k:"„Éà",r:"to"},
  {h:"„Å™",k:"„Éä",r:"na"},{h:"„Å´",k:"„Éã",r:"ni"},{h:"„Å¨",k:"„Éå",r:"nu"},{h:"„Å≠",k:"„Éç",r:"ne"},{h:"„ÅÆ",k:"„Éé",r:"no"},
  {h:"„ÅØ",k:"„Éè",r:"ha"},{h:"„Å≤",k:"„Éí",r:"hi"},{h:"„Åµ",k:"„Éï",r:"fu"},{h:"„Å∏",k:"„Éò",r:"he"},{h:"„Åª",k:"„Éõ",r:"ho"}
];

function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

/* ================== STATE ================== */
let benar = 0;
let salah = 0;
let answered = 0;
let resetCount = Number(localStorage.getItem("yomikata_reset")) || 0;

const benarEl = document.getElementById("benar");
const salahEl = document.getElementById("salah");

/* ================== POPUP ================== */
const popup = document.getElementById("popup");
const popupContent = document.getElementById("popupContent");

function showPopup(html){
  popupContent.innerHTML = html;
  popup.style.display = "flex";
}

function hidePopup(){
  popup.style.display = "none";
}

/* ================== SOAL ================== */
const quiz = document.getElementById("quiz");
let soal = [];

/* 1‚Äì10 (1 huruf) */
for(let i=0;i<10;i++){
  const k = kana[Math.floor(Math.random()*kana.length)];
  const useH = Math.random()>0.5;
  soal.push({
    q: useH ? k.h : k.k,
    a: k.r,
    opts: shuffle([k.r, ...shuffle(kana.map(x=>x.r).filter(r=>r!==k.r)).slice(0,3)])
  });
}

/* 11‚Äì15 (2 huruf) */
for(let i=0;i<5;i++){
  const pair = shuffle([...kana]).slice(0,2);
  const useH = Math.random()>0.5;
  soal.push({
    q: pair.map(x=>useH?x.h:x.k).join(" "),
    a: pair.map(x=>x.r).join(" "),
    opts: shuffle([
      pair.map(x=>x.r).join(" "),
      shuffle([...kana]).slice(0,2).map(x=>x.r).join(" "),
      shuffle([...kana]).slice(0,2).map(x=>x.r).join(" "),
      shuffle([...kana]).slice(0,2).map(x=>x.r).join(" ")
    ])
  });
}

/* 16‚Äì20 (3 huruf) */
for(let i=0;i<5;i++){
  const trio = shuffle([...kana]).slice(0,3);
  const useH = Math.random()>0.5;
  soal.push({
    q: trio.map(x=>useH?x.h:x.k).join(" "),
    a: trio.map(x=>x.r).join(" "),
    opts: shuffle([
      trio.map(x=>x.r).join(" "),
      shuffle([...kana]).slice(0,3).map(x=>x.r).join(" "),
      shuffle([...kana]).slice(0,3).map(x=>x.r).join(" "),
      shuffle([...kana]).slice(0,3).map(x=>x.r).join(" ")
    ])
  });
}

/* ================== RENDER ================== */
soal.forEach(s=>{
  const d=document.createElement("div");
  d.className="question";
  d.innerHTML=`
    <div class="kana">${s.q}</div>
    <div class="options">
      ${s.opts.map(o=>`<button>${o}</button>`).join("")}
    </div>`;
  
  d.querySelectorAll("button").forEach(b=>{
    b.onclick=()=>{
      if(b.disabled) return;

      d.querySelectorAll("button").forEach(x=>x.disabled=true);
      answered++;

      if(b.textContent===s.a){
        b.classList.add("correct");
        benar++;
      }else{
        b.classList.add("wrong");
        salah++;
      }

      benarEl.textContent = benar;
      salahEl.textContent = salah;

      if(salah > 5){
        handleFail();
      }else if(answered === 20){
        handlePass();
      }
    };
  });

  quiz.appendChild(d);
});

/* ================== FAIL / PASS ================== */
function handleFail(){
  showPopup(`
    <h2>Perlu Istirahat Sejenak</h2>

    <p>
      Kesalahanmu telah melebihi batas KKM.
    </p>

    <p>
      Disarankan untuk mengulang latihan pada halaman 31‚Äì33
      atau mengulangi blok huruf yang masih belum dikuasai.
    </p>

    <p>
      Gunakan tombol reset di bawah untuk mencoba kembali.
    </p>

    <button onclick="resetQuiz()">
      Reset (${3-resetCount}x tersisa)
    </button>
  `);
}

function handlePass(){
  showPopup(`
    <h2>Selamat! Kamu Lulus Tahap Pertama üéâ</h2>
    <p>Kamu berhasil melewati ujian tengah jilid tahap pertama ini dengan baik.
  Penguasaan huruf-huruf dari Blok 1 sampai Blok 6 sudah mengakar cukup kuat üëèüèª </p>
  <p>Tetapi, ini belum berakhir. Kamu harus melewati satu tahap lagi untuk melanjutkan ke blok 7 üòÑ.</p>
    
    <button onclick="location.href='https://yomikata47.github.io/Jilid-1-Soal-Latihan-2/'">
      Lanjut ke Halaman 35
    </button>
  `);
}

function resetQuiz(){
  resetCount++;
  localStorage.setItem("yomikata_reset", resetCount);

  if(resetCount >= 3){
    localStorage.setItem("yomikata_lock", Date.now() + COOLDOWN_MS);
    location.reload();
  }else{
    location.reload();
  }
}
</script>

</body>
</html>